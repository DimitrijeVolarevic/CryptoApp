import Foundation

// JSON data:
/*
 
 URL: https://api.coingecko.com/api/v3/global

 
 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 10836,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 711,
     "total_market_cap": {
       "btc": 42291928.06874069,
       "eth": 677665076.3904742,
       "ltc": 13890314837.102154,
       "bch": 9989222138.711216,
       "bnb": 3985466712.0924025,
       "eos": 1053285673079.3527,
       "xrp": 2525242034602.246,
       "xlm": 12332449490120.57,
       "link": 176933765950.00507,
       "dot": 202171516851.19553,
       "yfi": 139447444.4131045,
       "usd": 1268859436445.199,
       "aed": 4659651541349.257,
       "ars": 271137497536229.12,
       "aud": 1902419985953.8362,
       "bdt": 134995173548464,
       "bhd": 478406955338.9892,
       "bmd": 1268859436445.199,
       "brl": 6352544768562.904,
       "cad": 1710125607220.0024,
       "chf": 1143805725826.9072,
       "clp": 1022688017180467,
       "cny": 8733559501052.303,
       "czk": 27220841490058.863,
       "dkk": 8653621356556.284,
       "eur": 1161411150507.5825,
       "gbp": 1022779375059.8904,
       "hkd": 9960489477420.195,
       "huf": 437225961184012.94,
       "idr": 18884597523356864,
       "ils": 4658442318306.311,
       "inr": 104173989086431.5,
       "jpy": 169653802594483.03,
       "krw": 1681852380057654,
       "kwd": 388787413342.8645,
       "lkr": 408690355460815.7,
       "mmk": 2664598011641761,
       "mxn": 22994778251034.477,
       "myr": 5598842263314.434,
       "ngn": 584094791435274.5,
       "nok": 13336935857535.791,
       "nzd": 2048319788253.4856,
       "php": 70075940870574.52,
       "pkr": 366398529430186.2,
       "pln": 5416264810144.912,
       "rub": 104629504548677.3,
       "sar": 4759683343880.852,
       "sek": 13182476329477.861,
       "sgd": 1688765627466.8818,
       "thb": 43458435698247.984,
       "try": 24507893128995.383,
       "twd": 38697420051958.98,
       "uah": 46857517261850.67,
       "vef": 127050895371.25809,
       "vnd": 29750515971762560,
       "zar": 23397768008049.504,
       "xdr": 941354127304.3309,
       "xag": 50426504179.43038,
       "xau": 631866622.1609792,
       "bits": 42291928068740.69,
       "sats": 4229192806874069
     },
     "total_volume": {
       "btc": 1542393.8912796662,
       "eth": 24714561.90078021,
       "ltc": 506582171.374993,
       "bch": 364308649.6397363,
       "bnb": 145350656.52807963,
       "eos": 38413509672.32835,
       "xrp": 92096011367.52141,
       "xlm": 449766554202.96136,
       "link": 6452804878.482338,
       "dot": 7373229994.981245,
       "yfi": 5085672.284028778,
       "usd": 46275521903.012405,
       "aed": 169938293217.2612,
       "ars": 9888431173367.121,
       "aud": 69381584122.01514,
       "bdt": 4923297199762.527,
       "bhd": 17447583951.746113,
       "bmd": 46275521903.012405,
       "brl": 231678400407.43216,
       "cad": 62368575053.135506,
       "chf": 41714791566.33916,
       "clp": 37297607898609.01,
       "cny": 318514417258.4343,
       "czk": 992748771385.3254,
       "dkk": 315599059378.5456,
       "eur": 42356864432.74339,
       "gbp": 37300939736.186,
       "hkd": 363260764540.1626,
       "huf": 15945706011392.604,
       "idr": 688724520006686.5,
       "ils": 169894192644.88715,
       "inr": 3799243300896.189,
       "jpy": 6187303362683.714,
       "krw": 61337445595261.46,
       "kwd": 14179143839.736336,
       "lkr": 14905007562272.807,
       "mmk": 97178347820702.11,
       "mxn": 838623518135.1521,
       "myr": 204190740397.042,
       "ngn": 21302037513487.715,
       "nok": 486400344803.7755,
       "nzd": 74702575008.03296,
       "php": 2555681617276.231,
       "pkr": 13362617392340.607,
       "pln": 197532109274.89615,
       "rub": 3815856028157.2725,
       "sar": 173586470262.0071,
       "sek": 480767179246.99915,
       "sgd": 61589572917.42012,
       "thb": 1584936625178.1716,
       "try": 893807078004.4946,
       "twd": 1411301565618.1707,
       "uah": 1708901714477.0251,
       "vef": 4633568008.1486435,
       "vnd": 1085006434861059.8,
       "zar": 853320623891.55,
       "xdr": 34331346944.625954,
       "xag": 1839063281.2607527,
       "xau": 23044284.397262078,
       "bits": 1542393891279.6663,
       "sats": 154239389127966.62
     },
     "market_cap_percentage": {
       "btc": 45.739534429734036,
       "eth": 17.771012397970157,
       "usdt": 6.347394685377548,
       "bnb": 3.961119239063148,
       "usdc": 2.5528336008041155,
       "xrp": 2.046067359658992,
       "ada": 1.0905024718034866,
       "doge": 0.8964873853790479,
       "steth": 0.8728431627186836,
       "matic": 0.7918028747755829
     },
     "market_cap_change_percentage_24h_usd": -1.322428075845248,
     "updated_at": 1681300359
   }
 }
 
 
 */

struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
    
}

